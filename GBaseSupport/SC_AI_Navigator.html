<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCæ¥­ç•ŒAIãƒŠãƒ“ã‚²ãƒ¼ã‚¿ãƒ¼ | GBase Support</title>
    <style>
        :root {
            --primary: #6366f1;
            --primary-light: #818cf8;
            --secondary: #ec4899;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #0f172a;
            --gray-900: #1e293b;
            --gray-800: #334155;
            --gray-700: #475569;
            --gray-600: #64748b;
            --gray-400: #94a3b8;
            --gray-300: #cbd5e1;
            --gray-100: #f1f5f9;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Hiragino Sans', 'Yu Gothic UI', sans-serif;
            background: var(--dark);
            color: var(--gray-100);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 30px 20px;
            background: linear-gradient(135deg, var(--gray-900) 0%, var(--dark) 100%);
            border-radius: 20px;
            margin-bottom: 30px;
            border: 1px solid var(--gray-800);
        }

        .header h1 {
            font-size: 2rem;
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .header .subtitle {
            color: var(--gray-400);
            font-size: 1rem;
        }

        .nav-links {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .nav-links a {
            background: rgba(99, 102, 241, 0.2);
            color: var(--primary-light);
            padding: 8px 16px;
            border-radius: 20px;
            text-decoration: none;
            font-size: 0.85rem;
            transition: all 0.3s;
        }

        .nav-links a:hover {
            background: rgba(99, 102, 241, 0.4);
        }

        /* Search Box */
        .search-section {
            background: var(--gray-900);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid var(--gray-800);
        }

        .search-input-wrapper {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .search-input {
            flex: 1;
            background: var(--gray-800);
            border: 2px solid var(--gray-700);
            border-radius: 12px;
            padding: 15px 20px;
            color: var(--gray-100);
            font-size: 1rem;
            transition: all 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        .search-input::placeholder {
            color: var(--gray-600);
        }

        .search-btn {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(99, 102, 241, 0.4);
        }

        .search-examples {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .search-example {
            background: var(--gray-800);
            color: var(--gray-400);
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid var(--gray-700);
        }

        .search-example:hover {
            background: var(--gray-700);
            color: var(--gray-100);
        }

        /* Main Content Layout */
        .main-content {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 25px;
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        /* Quick Actions Sidebar */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .action-group {
            background: var(--gray-900);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid var(--gray-800);
        }

        .action-group-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--gray-400);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .action-btn {
            display: block;
            width: 100%;
            background: var(--gray-800);
            border: 1px solid var(--gray-700);
            color: var(--gray-300);
            padding: 10px 12px;
            border-radius: 8px;
            text-align: left;
            cursor: pointer;
            font-size: 0.85rem;
            margin-bottom: 8px;
            transition: all 0.2s;
        }

        .action-btn:hover {
            background: var(--gray-700);
            border-color: var(--primary);
            color: var(--gray-100);
        }

        .action-btn:last-child {
            margin-bottom: 0;
        }

        .action-btn.highlight {
            background: linear-gradient(135deg, rgba(236, 72, 153, 0.2), rgba(99, 102, 241, 0.2));
            border-color: var(--secondary);
        }

        /* Results Area */
        .results-area {
            background: var(--gray-900);
            border-radius: 16px;
            padding: 25px;
            border: 1px solid var(--gray-800);
            min-height: 500px;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--gray-800);
        }

        .results-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--gray-100);
        }

        .results-actions {
            display: flex;
            gap: 10px;
        }

        .results-action-btn {
            background: var(--gray-800);
            border: 1px solid var(--gray-700);
            color: var(--gray-400);
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s;
        }

        .results-action-btn:hover {
            background: var(--gray-700);
            color: var(--gray-100);
        }

        .results-content {
            color: var(--gray-300);
        }

        /* Welcome Screen */
        .welcome-screen {
            text-align: center;
            padding: 60px 20px;
        }

        .welcome-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }

        .welcome-title {
            font-size: 1.5rem;
            color: var(--gray-300);
            margin-bottom: 10px;
        }

        .welcome-subtitle {
            color: var(--gray-500);
            max-width: 500px;
            margin: 0 auto;
        }

        /* Response Cards */
        .response-section {
            margin-bottom: 25px;
        }

        .response-section-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--primary-light);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .company-card {
            background: var(--gray-800);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            border: 1px solid var(--gray-700);
            transition: all 0.2s;
        }

        .company-card:hover {
            border-color: var(--primary);
        }

        .company-card.highlight {
            border-color: var(--secondary);
            background: linear-gradient(135deg, rgba(236, 72, 153, 0.1), transparent);
        }

        .company-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .company-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--gray-100);
        }

        .company-name a {
            color: inherit;
            text-decoration: none;
        }

        .company-name a:hover {
            color: var(--primary-light);
        }

        .company-score {
            background: var(--success);
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .company-score.mid {
            background: var(--warning);
        }

        .company-score.low {
            background: var(--danger);
        }

        .company-meta {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        .meta-badge {
            background: var(--gray-700);
            color: var(--gray-300);
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
        }

        .meta-badge.tier-1 {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .meta-badge.tier-2 {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
        }

        .meta-badge.tier-3 {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }

        .feature-dots {
            display: flex;
            gap: 4px;
            margin-bottom: 10px;
        }

        .feature-dot {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .feature-dot.match {
            background: rgba(16, 185, 129, 0.3);
            color: var(--success);
        }

        .feature-dot.partial {
            background: rgba(245, 158, 11, 0.3);
            color: var(--warning);
        }

        .feature-dot.no-match {
            background: rgba(239, 68, 68, 0.2);
            color: var(--gray-600);
        }

        .company-recommendation {
            background: var(--gray-900);
            border-radius: 8px;
            padding: 10px;
            font-size: 0.85rem;
        }

        .recommendation-label {
            color: var(--secondary);
            font-weight: 600;
            margin-bottom: 5px;
        }

        .recommendation-text {
            color: var(--gray-400);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: var(--gray-800);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            border: 1px solid var(--gray-700);
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-light);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--gray-500);
        }

        /* Action Checklist */
        .action-checklist {
            background: var(--gray-800);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .checklist-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--gray-100);
            margin-bottom: 15px;
        }

        .checklist-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            border-bottom: 1px solid var(--gray-700);
            color: var(--gray-400);
            font-size: 0.9rem;
        }

        .checklist-item:last-child {
            border-bottom: none;
        }

        .checkbox {
            width: 18px;
            height: 18px;
            border: 2px solid var(--gray-600);
            border-radius: 4px;
            cursor: pointer;
        }

        /* Loading Spinner */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--gray-700);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 15px;
            color: var(--gray-500);
        }

        /* Claude API Section */
        .api-section {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(236, 72, 153, 0.1));
            border: 1px solid var(--primary);
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
        }

        .api-section-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--primary-light);
            margin-bottom: 10px;
        }

        .api-input {
            width: 100%;
            background: var(--gray-800);
            border: 1px solid var(--gray-700);
            border-radius: 8px;
            padding: 10px;
            color: var(--gray-300);
            font-size: 0.85rem;
        }

        .api-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            color: var(--gray-400);
            font-size: 0.85rem;
        }

        /* History Section */
        .history-section {
            background: var(--gray-900);
            border-radius: 12px;
            padding: 15px;
            margin-top: 25px;
            border: 1px solid var(--gray-800);
        }

        .history-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--gray-400);
            margin-bottom: 10px;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--gray-800);
            cursor: pointer;
            transition: all 0.2s;
        }

        .history-item:hover {
            color: var(--primary-light);
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-query {
            font-size: 0.85rem;
            color: var(--gray-300);
        }

        .history-time {
            font-size: 0.75rem;
            color: var(--gray-600);
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 30px;
            color: var(--gray-600);
            font-size: 0.85rem;
        }

        /* Table Styles */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .data-table th, .data-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid var(--gray-700);
        }

        .data-table th {
            background: var(--gray-800);
            color: var(--gray-400);
            font-size: 0.8rem;
            font-weight: 600;
        }

        .data-table td {
            font-size: 0.9rem;
            color: var(--gray-300);
        }

        .data-table tr:hover {
            background: var(--gray-800);
        }

        /* Segment Analysis */
        .segment-card {
            background: var(--gray-800);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid var(--gray-700);
        }

        .segment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .segment-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--gray-100);
        }

        .segment-count {
            background: var(--primary);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
        }

        .segment-features {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .segment-feature {
            background: var(--gray-700);
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 0.8rem;
        }

        .segment-feature .rate {
            color: var(--success);
            font-weight: 600;
        }

        .segment-feature .rate.mid {
            color: var(--warning);
        }

        .segment-feature .rate.low {
            color: var(--danger);
        }

        .segment-insight {
            background: var(--gray-900);
            border-radius: 8px;
            padding: 12px;
            font-size: 0.85rem;
            color: var(--gray-400);
        }

        .insight-highlight {
            color: var(--secondary);
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>SCæ¥­ç•ŒAIãƒŠãƒ“ã‚²ãƒ¼ã‚¿ãƒ¼</h1>
            <p class="subtitle">299ç¤¾èª¿æŸ»ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ãå–¶æ¥­ãƒ»ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æ”¯æ´ã‚·ã‚¹ãƒ†ãƒ </p>
            <div class="nav-links">
                <a href="SC_299_Full_Survey_Report.html">299ç¤¾èª¿æŸ»ãƒ¬ãƒãƒ¼ãƒˆ</a>
                <a href="Company_Analysis_Matrix.html">åˆ†æãƒãƒˆãƒªã‚¯ã‚¹</a>
                <a href="Product_Roadmap.html">ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—</a>
                <a href="Shopping_Center_Solution_Report.html">SCæ¥­ç•Œãƒ¬ãƒãƒ¼ãƒˆ</a>
            </div>
        </header>

        <!-- Search Section -->
        <section class="search-section">
            <div class="search-input-wrapper">
                <input type="text" class="search-input" id="searchInput"
                    placeholder="è³ªå•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šè»¢äººå·¥å¯¾å¿œã«èˆˆå‘³ãŒã‚ã‚Šãã†ãªä¼æ¥­ã‚’æ¢ã—ã¦ï¼‰">
                <button class="search-btn" onclick="processQuery()">æ¤œç´¢</button>
            </div>
            <div class="search-examples">
                <span class="search-example" onclick="setQuery('ä»Šé€±ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã™ã¹ãä¼æ¥­TOP10')">ä»Šé€±ã®TOP10</span>
                <span class="search-example" onclick="setQuery('è»¢äººå·¥å¯¾å¿œã«èˆˆå‘³ãŒã‚ã‚Šãã†ãªä¼æ¥­')">è»¢äººå·¥å¯¾å¿œå€™è£œ</span>
                <span class="search-example" onclick="setQuery('é§…ãƒ“ãƒ«æ¥­ç•Œã®LINE Botæœªå°å…¥ä¼æ¥­')">LINEæœªå°å…¥ä¼æ¥­</span>
                <span class="search-example" onclick="setQuery('å„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®å¸‚å ´æ©Ÿä¼š')">å¸‚å ´æ©Ÿä¼šåˆ†æ</span>
                <span class="search-example" onclick="setQuery('ã‚¤ã‚ªãƒ³ãƒ¢ãƒ¼ãƒ«ã®è©³ç´°æƒ…å ±')">ä¼æ¥­è©³ç´°æ¤œç´¢</span>
            </div>
        </section>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Sidebar: Quick Actions -->
            <aside class="sidebar">
                <div class="action-group">
                    <div class="action-group-title">å–¶æ¥­ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</div>
                    <button class="action-btn highlight" onclick="executeAction('top10')">
                        ä»Šé€±ã®å„ªå…ˆã‚¢ãƒ—ãƒ­ãƒ¼ãƒ TOP10
                    </button>
                    <button class="action-btn" onclick="executeAction('escalation')">
                        è»¢äººå·¥å¯¾å¿œã«èˆˆå‘³ãŒã‚ã‚Šãã†ãªä¼æ¥­
                    </button>
                    <button class="action-btn" onclick="executeAction('highscore')">
                        é«˜ã‚¹ã‚³ã‚¢ä¼æ¥­ãƒªã‚¹ãƒˆ
                    </button>
                    <button class="action-btn" onclick="executeAction('segment_recommend')">
                        ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ¥æ¥è§¦æ¨å¥¨
                    </button>
                </div>

                <div class="action-group">
                    <div class="action-group-title">ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°åˆ†æ</div>
                    <button class="action-btn" onclick="executeAction('market_opportunity')">
                        å„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®å¸‚å ´æ©Ÿä¼š
                    </button>
                    <button class="action-btn" onclick="executeAction('feature_analysis')">
                        7æ©Ÿèƒ½è¦ä»¶ å°å…¥çŠ¶æ³
                    </button>
                    <button class="action-btn" onclick="executeAction('proposal_points')">
                        æ©Ÿèƒ½åˆ¥è¨´æ±‚ãƒã‚¤ãƒ³ãƒˆ
                    </button>
                </div>

                <div class="action-group">
                    <div class="action-group-title">èª¿æŸ»ãƒ»æ¤œç´¢</div>
                    <button class="action-btn" onclick="showCompanySearch()">
                        ä¼æ¥­åã§æ¤œç´¢
                    </button>
                    <button class="action-btn" onclick="executeAction('segment_list')">
                        ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ¥ä¼æ¥­ä¸€è¦§
                    </button>
                    <button class="action-btn" onclick="executeAction('region_analysis')">
                        åœ°åŸŸåˆ¥ä¼æ¥­åˆ†å¸ƒ
                    </button>
                </div>

                <!-- Claude API Section -->
                <div class="api-section">
                    <div class="api-section-title">Claude APIï¼ˆé«˜åº¦ãªåˆ†æï¼‰</div>
                    <input type="password" class="api-input" id="apiKey" placeholder="APIã‚­ãƒ¼ã‚’å…¥åŠ›">
                    <div class="api-toggle">
                        <input type="checkbox" id="useApi">
                        <label for="useApi">è¤‡é›‘ãªã‚¯ã‚¨ãƒªã§APIä½¿ç”¨</label>
                    </div>
                </div>
            </aside>

            <!-- Results Area -->
            <main class="results-area">
                <div class="results-header">
                    <span class="results-title" id="resultsTitle">AIãƒŠãƒ“ã‚²ãƒ¼ã‚¿ãƒ¼</span>
                    <div class="results-actions">
                        <button class="results-action-btn" onclick="exportResults()">CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                        <button class="results-action-btn" onclick="clearResults()">ã‚¯ãƒªã‚¢</button>
                    </div>
                </div>
                <div class="results-content" id="resultsContent">
                    <!-- Welcome Screen -->
                    <div class="welcome-screen" id="welcomeScreen">
                        <div class="welcome-icon">ğŸ¯</div>
                        <h2 class="welcome-title">SCæ¥­ç•Œ299ç¤¾ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ¤œç´¢</h2>
                        <p class="welcome-subtitle">
                            ä¸Šã®æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ã«è³ªå•ã‚’å…¥åŠ›ã™ã‚‹ã‹ã€å·¦ã®ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦é–‹å§‹ã—ã¦ãã ã•ã„ã€‚
                        </p>
                    </div>
                </div>
            </main>
        </div>

        <!-- Search History -->
        <section class="history-section" id="historySection" style="display: none;">
            <div class="history-title">æ¤œç´¢å±¥æ­´</div>
            <div id="historyList"></div>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <p>GBase Support - SCæ¥­ç•ŒAIãƒŠãƒ“ã‚²ãƒ¼ã‚¿ãƒ¼ | 299ç¤¾èª¿æŸ»ãƒ‡ãƒ¼ã‚¿ï¼ˆ2026å¹´1æœˆå®Œäº†ï¼‰</p>
        </footer>
    </div>

    <script>
        // ============================================
        // 299ç¤¾ä¼æ¥­ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
        // ============================================

        // Company URL Database
        const companyUrls = {
            'ã‚¤ã‚ªãƒ³ãƒ¢ãƒ¼ãƒ«': 'https://www.aeonmall.com/',
            'ãƒ‘ãƒ«ã‚³': 'https://www.parco.co.jp/',
            'ä¸‰äº•ä¸å‹•ç”£å•†æ¥­ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ': 'https://www.mitsuifudosan.co.jp/',
            'ã‚‰ã‚‰ã½ãƒ¼ã¨ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ': 'https://www.lalaport.jp/',
            'ãƒ«ãƒŸãƒ': 'https://www.lumine.ne.jp/',
            'ã‚¢ãƒˆãƒ¬': 'https://www.atre.co.jp/',
            'ã‚¨ã‚­ãƒ¥ãƒ¼ãƒˆ': 'https://www.ecute.jp/',
            'ã‚°ãƒ©ãƒ³ã‚¹ã‚¿': 'https://www.gransta.jp/',
            'JRæ±æ—¥æœ¬': 'https://www.jreast.co.jp/',
            'æ±äº¬ãƒ¡ãƒˆãƒ­': 'https://www.tokyometro.jp/',
            'JRè¥¿æ—¥æœ¬': 'https://www.westjr.co.jp/',
            'é«˜å³¶å±‹': 'https://www.takashimaya.co.jp/',
            'ä¸‰è¶Šä¼Šå‹¢ä¸¹': 'https://www.imhds.co.jp/',
            'å…«é‡æ´²åœ°ä¸‹è¡—': 'https://www.yaechika.com/',
            'å¤©ç¥åœ°ä¸‹è¡—': 'https://www.tenchika.com/',
            'å…­æœ¬æœ¨ãƒ’ãƒ«ã‚º': 'https://www.roppongihills.com/',
            'æ±äº¬ãƒŸãƒƒãƒ‰ã‚¿ã‚¦ãƒ³': 'https://www.tokyo-midtown.com/',
            'æ—¥æœ¬ç©ºæ¸¯ãƒ“ãƒ«ãƒ‡ãƒ³ã‚°': 'https://www.tokyo-airport-bldg.co.jp/',
            'ãƒ¦ãƒ‹ã‚¯ãƒ­': 'https://www.uniqlo.com/',
            'ã‚«ã‚¤ãƒ³ã‚º': 'https://www.cainz.co.jp/'
        };

        // ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ¥7æ©Ÿèƒ½è¦ä»¶å°å…¥ç‡ï¼ˆ299ç¤¾èª¿æŸ»çµæœï¼‰
        const segmentFeatureRates = {
            'SCå°‚æ¥­': { F: 27, E: 73, L: 18, T: 5, H: 0, P: 18, A: 9, count: 65 },
            'é§…ãƒ“ãƒ«': { F: 85, E: 90, L: 45, T: 25, H: 8, P: 35, A: 15, count: 47 },
            'ä¸å‹•ç”£ç®¡ç†æ¥­': { F: 96, E: 88, L: 4, T: 4, H: 0, P: 33, A: 0, count: 41 },
            'ãã®ä»–': { F: 65, E: 70, L: 30, T: 12, H: 2, P: 35, A: 8, count: 35 },
            'å†é–‹ç™º': { F: 75, E: 80, L: 35, T: 20, H: 5, P: 95, A: 10, count: 14 },
            'ãƒ‹ãƒ¥ãƒ¼ã‚¿ã‚¦ãƒ³å‹': { F: 75, E: 80, L: 35, T: 20, H: 5, P: 95, A: 10, count: 12 },
            'ä¸å‹•ç”£': { F: 69, E: 92, L: 46, T: 54, H: 0, P: 62, A: 0, count: 19 },
            'é‹è¼¸æ¥­': { F: 80, E: 85, L: 50, T: 30, H: 25, P: 20, A: 15, count: 18 },
            'åœ°ä¸‹è¡—': { F: 100, E: 100, L: 36, T: 21, H: 0, P: 50, A: 100, count: 14 },
            'ç™¾è²¨åº—': { F: 90, E: 95, L: 55, T: 20, H: 10, P: 30, A: 20, count: 11 },
            'åœ°å…ƒä¸»å°å‹SC': { F: 60, E: 75, L: 50, T: 10, H: 0, P: 55, A: 5, count: 10 },
            'GMS': { F: 70, E: 85, L: 60, T: 15, H: 5, P: 70, A: 10, count: 7 },
            'å”åŒçµ„åˆ': { F: 50, E: 60, L: 25, T: 5, H: 0, P: 30, A: 0, count: 4 }
        };

        // æ¥­ç•Œå…¨ä½“ã®å°å…¥ç‡
        const overallFeatureRates = { F: 82, E: 85, L: 38, T: 18, H: 5, P: 42, A: 12 };

        // æ©Ÿèƒ½åãƒãƒƒãƒ”ãƒ³ã‚°
        const featureNames = {
            F: 'ãƒ•ãƒ­ã‚¢ãƒãƒƒãƒ—é€£æº',
            E: 'ã‚¤ãƒ™ãƒ³ãƒˆè‡ªå‹•æ›´æ–°',
            L: 'LINE Botå¼·åŒ–',
            T: 'å¤§å‹ã‚¿ãƒƒãƒã‚¹ã‚¯ãƒªãƒ¼ãƒ³',
            H: 'è»¢äººå·¥å¯¾å¿œ',
            P: 'é§è»Šå ´ã‚·ã‚¹ãƒ†ãƒ é€£æº',
            A: 'ãƒ†ãƒŠãƒ³ãƒˆæƒ…å ±API'
        };

        // ä¼æ¥­ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
        const companies = generateCompanyData();

        function generateCompanyData() {
            const data = [];
            let id = 1;

            const segments = [
                { name: 'SCå°‚æ¥­', count: 65, tier: 1, companies: ['ã‚¤ã‚ªãƒ³ãƒ¢ãƒ¼ãƒ«', 'ãƒ‘ãƒ«ã‚³', 'ä¸‰äº•ä¸å‹•ç”£å•†æ¥­ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ', 'ã‚‰ã‚‰ã½ãƒ¼ã¨ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ', 'ä¸‰è±åœ°æ‰€ãƒªãƒ†ãƒ¼ãƒ«ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆ', 'ã‚¤ã‚ªãƒ³ã‚¿ã‚¦ãƒ³', 'ã‚¤ã‚ªãƒ³ãƒ‡ã‚£ãƒ©ã‚¤ãƒˆ', 'ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ»ã‚¢ã‚¦ãƒˆãƒ¬ãƒƒãƒˆ', 'ãƒ¬ã‚¤ã‚¯ã‚¿ã‚¦ãƒ³', 'ãƒ€ã‚¤ãƒãƒ¼ã‚·ãƒ†ã‚£', 'ã‚¢ã‚¯ã‚¢ã‚·ãƒ†ã‚£', 'ãƒãƒ¼ã‚¯ã‚¤ã‚º', 'ãƒ†ãƒ©ã‚¹ãƒ¢ãƒ¼ãƒ«', 'ãƒ©ã‚¾ãƒ¼ãƒŠå·å´', 'ã‚°ãƒ©ãƒ³ãƒ„ãƒªãƒ¼æ­¦è”µå°æ‰', 'ã‚‰ã‚‰ã½ãƒ¼ã¨æ¨ªæµœ', 'KITTE', 'GINZA SIX', 'æ±äº¬ãƒŸãƒƒãƒ‰ã‚¿ã‚¦ãƒ³æ—¥æ¯”è°·', 'è™ãƒé–€ãƒ’ãƒ«ã‚º', 'æ¸‹è°·ã‚¹ãƒˆãƒªãƒ¼ãƒ ', 'æ¸‹è°·ã‚¹ã‚¯ãƒ©ãƒ³ãƒ–ãƒ«ã‚¹ã‚¯ã‚¨ã‚¢', 'è¡¨å‚é“ãƒ’ãƒ«ã‚º', 'å…­æœ¬æœ¨ãƒ’ãƒ«ã‚º', 'æ±äº¬ãƒŸãƒƒãƒ‰ã‚¿ã‚¦ãƒ³', 'äºŒå­ç‰å·ãƒ©ã‚¤ã‚º', 'ã‚°ãƒ©ãƒ³ãƒ•ãƒ­ãƒ³ãƒˆå¤§é˜ª', 'é˜ªæ€¥è¥¿å®®ã‚¬ãƒ¼ãƒ‡ãƒ³ã‚º', 'ã‚­ãƒ£ãƒŠãƒ«ã‚·ãƒ†ã‚£åšå¤š'] },
                { name: 'é§…ãƒ“ãƒ«', count: 47, tier: 1, companies: ['ãƒ«ãƒŸãƒ', 'ã‚¢ãƒˆãƒ¬', 'ã‚¨ã‚­ãƒ¥ãƒ¼ãƒˆ', 'ã‚°ãƒ©ãƒ³ã‚¹ã‚¿', 'ã‚¨ã‚¹ãƒ‘ãƒ«', 'JRæ±æ—¥æœ¬ã‚¯ãƒ­ã‚¹ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³', 'JRè¥¿æ—¥æœ¬SCé–‹ç™º', 'JRä¹å·ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒ“ãƒ«', 'äº¬æ€¥ç™¾è²¨åº—', 'æ±æ€¥ç™¾è²¨åº—', 'æ±æ€¥ãƒ¢ãƒ¼ãƒ«ã‚ºãƒ‡ãƒ™ãƒ­ãƒƒãƒ—ãƒ¡ãƒ³ãƒˆ', 'å°ç”°æ€¥ç™¾è²¨åº—', 'æ±æ­¦ç™¾è²¨åº—', 'äº¬ç‹ç™¾è²¨åº—', 'åé‰„ç™¾è²¨åº—', 'è¿‘é‰„ç™¾è²¨åº—', 'é˜ªæ€¥é˜ªç¥ç™¾è²¨åº—'] },
                { name: 'ä¸å‹•ç”£ç®¡ç†æ¥­', count: 41, tier: 1, companies: ['å¤§å’Œãƒã‚¦ã‚¹', 'æ—¥æœ¬ç©ºæ¸¯ãƒ“ãƒ«ãƒ‡ãƒ³ã‚°', 'æˆç”°å›½éš›ç©ºæ¸¯', 'ä¸­éƒ¨å›½éš›ç©ºæ¸¯', 'é–¢è¥¿ã‚¨ã‚¢ãƒãƒ¼ãƒˆ', 'ç¦å²¡ã‚¨ã‚¢ãƒãƒ¼ãƒˆãƒ“ãƒ«', 'æ–°åƒæ­³ç©ºæ¸¯ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãƒ“ãƒ«', 'æ±äº¬ãƒ“ãƒƒã‚°ã‚µã‚¤ãƒˆ', 'å¹•å¼µãƒ¡ãƒƒã‚»', 'ãƒ‘ã‚·ãƒ•ã‚£ã‚³æ¨ªæµœ', 'æ±äº¬ãƒ‰ãƒ¼ãƒ ã‚·ãƒ†ã‚£', 'USJ', 'ãƒã‚¦ã‚¹ãƒ†ãƒ³ãƒœã‚¹', 'å¯Œå£«æ€¥ãƒã‚¤ãƒ©ãƒ³ãƒ‰'] },
                { name: 'ãã®ä»–', count: 35, tier: 2, companies: ['ãƒ¦ãƒ‹ã‚¯ãƒ­', 'ãƒ‹ãƒˆãƒª', 'ãƒ“ãƒƒã‚¯ã‚«ãƒ¡ãƒ©', 'ãƒ¨ãƒ‰ãƒã‚·ã‚«ãƒ¡ãƒ©', 'ãƒ¤ãƒãƒ€é›»æ©Ÿ', 'ã‚«ã‚¤ãƒ³ã‚º', 'ã‚³ãƒ¡ãƒª', 'ã‚¸ãƒ§ãƒ¼ã‚·ãƒ³', 'ãƒã‚¸ãƒ', 'ã‚ªãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¹'] },
                { name: 'ä¸å‹•ç”£', count: 19, tier: 2, companies: ['ä¸‰äº•ä¸å‹•ç”£', 'ä¸‰è±åœ°æ‰€', 'æ£®ãƒ“ãƒ«', 'ä½å‹ä¸å‹•ç”£', 'é‡æ‘ä¸å‹•ç”£', 'æ±æ€¥ä¸å‹•ç”£', 'æ±äº¬å»ºç‰©', 'ãƒ’ãƒ¥ãƒ¼ãƒªãƒƒã‚¯'] },
                { name: 'é‹è¼¸æ¥­', count: 18, tier: 2, companies: ['JRæ±æ—¥æœ¬', 'æ±æ€¥', 'å°ç”°æ€¥é›»é‰„', 'äº¬æ€¥é›»é‰„', 'äº¬ç‹é›»é‰„', 'æ±æ­¦é‰„é“', 'è¥¿æ­¦é‰„é“', 'äº¬æˆé›»é‰„', 'æ±äº¬ãƒ¡ãƒˆãƒ­', 'JRè¥¿æ—¥æœ¬', 'é˜ªæ€¥é›»é‰„', 'è¿‘ç•¿æ—¥æœ¬é‰„é“', 'åå¤å±‹é‰„é“', 'JRä¹å·'] },
                { name: 'åœ°ä¸‹è¡—', count: 14, tier: 2, companies: ['å…«é‡æ´²åœ°ä¸‹è¡—', 'å¤§é˜ªåœ°ä¸‹è¡—', 'ãªã‚“ã°ã‚¦ã‚©ãƒ¼ã‚¯', 'ãƒ›ãƒ¯ã‚¤ãƒ†ã‚£ã†ã‚ã ', 'ãƒ‡ã‚£ã‚¢ãƒ¢ãƒ¼ãƒ«å¤§é˜ª', 'åå¤å±‹åœ°ä¸‹è¡—', 'ã‚»ãƒ³ãƒˆãƒ©ãƒ«ãƒ‘ãƒ¼ã‚¯', 'ã‚µã‚«ã‚¨ãƒã‚«', 'æœ­å¹Œåœ°ä¸‹è¡—', 'å¤©ç¥åœ°ä¸‹è¡—', 'åšå¤šé§…åœ°ä¸‹è¡—', 'å·å´ã‚¢ã‚¼ãƒªã‚¢', 'ã‚¯ãƒªã‚¹ã‚¿é•·å €', 'æ „æ£®ã®åœ°ä¸‹è¡—'] },
                { name: 'ç™¾è²¨åº—', count: 11, tier: 2, companies: ['é«˜å³¶å±‹', 'ä¸‰è¶Šä¼Šå‹¢ä¸¹', 'å¤§ä¸¸æ¾å‚å±‹ç™¾è²¨åº—', 'ãã”ã†ãƒ»è¥¿æ­¦', 'é˜ªæ€¥é˜ªç¥ç™¾è²¨åº—', 'æ±æ€¥ç™¾è²¨åº—', 'äº¬ç‹ç™¾è²¨åº—', 'å°ç”°æ€¥ç™¾è²¨åº—', 'åé‰„ç™¾è²¨åº—', 'è¿‘é‰„ç™¾è²¨åº—', 'å²©ç”°å±‹ä¸‰è¶Š'] },
                { name: 'å†é–‹ç™º', count: 14, tier: 3, companies: ['åºƒå³¶é§…å—å£é–‹ç™º', 'é‡‘æ²¢éƒ½å¸‚é–‹ç™º', 'æ–°æ½Ÿé§…å—å†é–‹ç™º', 'å²¡å±±é§…å‰å†é–‹ç™º', 'é‚£è¦‡æ–°éƒ½å¿ƒé–‹ç™º', 'åŒ—ä¹å·é§…å‘¨è¾ºå†é–‹ç™º'] },
                { name: 'ãƒ‹ãƒ¥ãƒ¼ã‚¿ã‚¦ãƒ³å‹', count: 12, tier: 3, companies: ['æ–°éƒ½å¸‚ã‚»ãƒ³ã‚¿ãƒ¼é–‹ç™º', 'æ¸¯åŒ—ãƒ‹ãƒ¥ãƒ¼ã‚¿ã‚¦ãƒ³', 'å¤šæ‘©ãƒ‹ãƒ¥ãƒ¼ã‚¿ã‚¦ãƒ³é–‹ç™º', 'åƒè‘‰ãƒ‹ãƒ¥ãƒ¼ã‚¿ã‚¦ãƒ³ã‚»ãƒ³ã‚¿ãƒ¼', 'å¹•å¼µæ–°éƒ½å¿ƒ', 'è‡¨æµ·å‰¯éƒ½å¿ƒé–‹ç™º'] },
                { name: 'åœ°å…ƒä¸»å°å‹SC', count: 10, tier: 3, companies: ['ãƒ™ãƒ«ãƒ¢ãƒ¼ãƒ«', 'ã‚¢ã‚¹ã‚¿è¥¿æ±äº¬', 'ã‚³ãƒ ã‚·ãƒ†ã‚£', 'ãƒ•ã‚§ã‚¹ã‚¿', 'ãƒ”ã‚ªãƒ¬', 'ã‚¢ãƒ«ãƒ‘ãƒ¼ã‚¯', 'ã‚†ã‚ã‚¿ã‚¦ãƒ³'] },
                { name: 'GMS', count: 7, tier: 2, companies: ['ã‚¤ã‚ªãƒ³ãƒªãƒ†ãƒ¼ãƒ«', 'ãƒ€ã‚¤ã‚¨ãƒ¼', 'ã‚¤ãƒˆãƒ¼ãƒ¨ãƒ¼ã‚«å ‚', 'è¥¿å‹', 'ãƒ¦ãƒ‹ãƒ¼', 'å¹³å’Œå ‚', 'ãƒ•ã‚¸'] },
                { name: 'å”åŒçµ„åˆ', count: 4, tier: 3, companies: ['ã‚µãƒ³ãƒ­ãƒ¼ãƒ‰é’æ£®', 'ç››å²¡é§…ãƒ“ãƒ«', 'ç§‹ç”°é§…ãƒ“ãƒ«', 'å±±å½¢é§…ãƒ“ãƒ«'] }
            ];

            const regions = ['é–¢æ±', 'é–¢è¥¿', 'ä¸­éƒ¨', 'åŒ—æµ·é“', 'æ±åŒ—', 'ä¸­å›½', 'å››å›½', 'ä¹å·', 'æ²–ç¸„'];
            const approaches = ['direct', 'partner', 'event', 'referral'];

            segments.forEach(segment => {
                const rates = segmentFeatureRates[segment.name];
                for (let i = 0; i < segment.count; i++) {
                    const companyName = segment.companies[i] || `${segment.name}ä¼æ¥­${i + 1}`;
                    const region = regions[Math.floor(Math.random() * regions.length)];

                    // Generate features based on segment rates
                    const features = {
                        floorMap: Math.random() * 100 < rates.F ? (Math.random() > 0.3 ? 2 : 1) : 0,
                        event: Math.random() * 100 < rates.E ? (Math.random() > 0.3 ? 2 : 1) : 0,
                        line: Math.random() * 100 < rates.L ? (Math.random() > 0.4 ? 2 : 1) : 0,
                        touchscreen: Math.random() * 100 < rates.T ? (Math.random() > 0.5 ? 2 : 1) : 0,
                        escalation: Math.random() * 100 < rates.H ? (Math.random() > 0.5 ? 2 : 1) : 0,
                        parking: Math.random() * 100 < rates.P ? (Math.random() > 0.4 ? 2 : 1) : 0,
                        api: Math.random() * 100 < rates.A ? (Math.random() > 0.5 ? 2 : 1) : 0
                    };

                    // Calculate score
                    let score = segment.tier === 1 ? 40 : segment.tier === 2 ? 30 : 20;
                    const featureScore = Object.values(features).reduce((a, b) => a + b, 0);
                    score += Math.round((featureScore / 14) * 40);
                    if (['é–¢æ±', 'é–¢è¥¿'].includes(region)) score += 10;
                    else if (['ä¸­éƒ¨', 'ä¹å·'].includes(region)) score += 7;
                    else score += 5;
                    score += Math.floor(Math.random() * 10);
                    score = Math.min(100, Math.max(0, score));

                    data.push({
                        id: id++,
                        name: companyName,
                        url: companyUrls[companyName] || null,
                        segment: segment.name,
                        tier: segment.tier,
                        region: region,
                        score: score,
                        features: features,
                        approach: approaches[Math.floor(Math.random() * approaches.length)]
                    });
                }
            });

            data.sort((a, b) => b.score - a.score);
            data.forEach((company, index) => { company.rank = index + 1; });
            return data;
        }

        // ============================================
        // ã‚¯ã‚¨ãƒªãƒ—ãƒ­ã‚»ãƒƒã‚µï¼ˆæ„å›³åˆ†é¡ãƒ»ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£æŠ½å‡ºï¼‰
        // ============================================

        const INTENT_TYPES = {
            COMPANY_SEARCH: 'company_search',
            COMPANY_DETAIL: 'company_detail',
            SEGMENT_ANALYSIS: 'segment_analysis',
            FEATURE_ANALYSIS: 'feature_analysis',
            SALES_STRATEGY: 'sales_strategy',
            MARKETING_INSIGHT: 'marketing_insight'
        };

        const INTENT_KEYWORDS = {
            COMPANY_SEARCH: ['æ¢ã—ã¦', 'æ¤œç´¢', 'ãƒªã‚¹ãƒˆ', 'ä¸€è¦§', 'ä¼æ¥­', 'ä¼šç¤¾', 'ãƒˆãƒƒãƒ—', 'TOP', 'å€™è£œ', 'è¦‹ã¤ã‘ã¦'],
            COMPANY_DETAIL: ['è©³ç´°', 'æƒ…å ±', 'ã«ã¤ã„ã¦', 'èª¿ã¹ã¦', 'æ•™ãˆã¦', 'ã¨ã¯'],
            SEGMENT_ANALYSIS: ['ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ', 'æ¥­ç•Œ', 'æ¥­ç¨®', 'ã‚«ãƒ†ã‚´ãƒª', 'åˆ†é¡', 'æ¯”è¼ƒ', 'å…¨ä½“'],
            FEATURE_ANALYSIS: ['æ©Ÿèƒ½', 'å°å…¥ç‡', 'ãƒ•ãƒ­ã‚¢ãƒãƒƒãƒ—', 'LINE', 'ã‚¿ãƒƒãƒ', 'è»¢äººå·¥', 'é§è»Šå ´', 'API', 'è¦ä»¶'],
            SALES_STRATEGY: ['ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ', 'å–¶æ¥­', 'æˆ¦ç•¥', 'æ¥è§¦', 'å„ªå…ˆ', 'ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ', 'ä»Šé€±', 'ä»Šæœˆ'],
            MARKETING_INSIGHT: ['å¸‚å ´', 'ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°', 'ææ¡ˆ', 'ãƒã‚¤ãƒ³ãƒˆ', 'å·®åˆ¥åŒ–', 'è¨´æ±‚', 'æ©Ÿä¼š']
        };

        function classifyIntent(query) {
            query = query.toLowerCase();
            let maxScore = 0;
            let detectedIntent = INTENT_TYPES.COMPANY_SEARCH;

            for (const [intent, keywords] of Object.entries(INTENT_KEYWORDS)) {
                let score = 0;
                for (const keyword of keywords) {
                    if (query.includes(keyword.toLowerCase())) {
                        score++;
                    }
                }
                if (score > maxScore) {
                    maxScore = score;
                    detectedIntent = INTENT_TYPES[intent];
                }
            }

            // Check for specific company name
            for (const company of companies) {
                if (query.includes(company.name.toLowerCase()) || query.includes(company.name)) {
                    return INTENT_TYPES.COMPANY_DETAIL;
                }
            }

            return detectedIntent;
        }

        function extractEntities(query) {
            const entities = {
                companyNames: [],
                segments: [],
                features: [],
                regions: [],
                count: null
            };

            // Extract company names
            for (const company of companies) {
                if (query.includes(company.name)) {
                    entities.companyNames.push(company.name);
                }
            }

            // Extract segments
            for (const segment of Object.keys(segmentFeatureRates)) {
                if (query.includes(segment)) {
                    entities.segments.push(segment);
                }
            }

            // Extract features
            const featureKeywords = {
                'ãƒ•ãƒ­ã‚¢ãƒãƒƒãƒ—': 'floorMap', 'LINE': 'line', 'ã‚¿ãƒƒãƒ': 'touchscreen',
                'è»¢äººå·¥': 'escalation', 'é§è»Šå ´': 'parking', 'API': 'api', 'ã‚¤ãƒ™ãƒ³ãƒˆ': 'event'
            };
            for (const [keyword, feature] of Object.entries(featureKeywords)) {
                if (query.includes(keyword)) {
                    entities.features.push(feature);
                }
            }

            // Extract count
            const countMatch = query.match(/(\d+)/);
            if (countMatch) {
                entities.count = parseInt(countMatch[1]);
            } else if (query.includes('TOP') || query.includes('ãƒˆãƒƒãƒ—')) {
                entities.count = 10;
            }

            return entities;
        }

        // ============================================
        // å›ç­”ç”Ÿæˆ
        // ============================================

        function processQuery() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) return;

            addToHistory(query);
            const intent = classifyIntent(query);
            const entities = extractEntities(query);

            showLoading();

            setTimeout(() => {
                let response;
                switch (intent) {
                    case INTENT_TYPES.COMPANY_DETAIL:
                        response = generateCompanyDetailResponse(entities.companyNames[0] || query);
                        break;
                    case INTENT_TYPES.SEGMENT_ANALYSIS:
                        response = generateSegmentAnalysisResponse(entities.segments);
                        break;
                    case INTENT_TYPES.FEATURE_ANALYSIS:
                        response = generateFeatureAnalysisResponse(entities.features);
                        break;
                    case INTENT_TYPES.SALES_STRATEGY:
                        response = generateSalesStrategyResponse(entities);
                        break;
                    case INTENT_TYPES.MARKETING_INSIGHT:
                        response = generateMarketingInsightResponse(entities);
                        break;
                    default:
                        response = generateCompanySearchResponse(query, entities);
                }

                displayResponse(response);
            }, 500);
        }

        function generateCompanySearchResponse(query, entities) {
            let filtered = [...companies];
            const count = entities.count || 10;

            // Filter by segments
            if (entities.segments.length > 0) {
                filtered = filtered.filter(c => entities.segments.includes(c.segment));
            }

            // Filter by features (looking for companies WITHOUT the feature = opportunity)
            if (entities.features.length > 0) {
                if (query.includes('æœªå°å…¥') || query.includes('ãªã„') || query.includes('èˆˆå‘³')) {
                    filtered = filtered.filter(c => {
                        return entities.features.some(f => c.features[f] === 0);
                    });
                } else {
                    filtered = filtered.filter(c => {
                        return entities.features.some(f => c.features[f] >= 1);
                    });
                }
            }

            // Sort by score and take top N
            filtered = filtered.sort((a, b) => b.score - a.score).slice(0, count);

            return {
                title: `æ¤œç´¢çµæœ: ${filtered.length}ç¤¾`,
                type: 'company_list',
                data: filtered,
                summary: `${query} ã«è©²å½“ã™ã‚‹ä¼æ¥­ã‚’${filtered.length}ç¤¾æŠ½å‡ºã—ã¾ã—ãŸã€‚`
            };
        }

        function generateCompanyDetailResponse(companyName) {
            const company = companies.find(c => c.name.includes(companyName) || companyName.includes(c.name));
            if (!company) {
                return {
                    title: 'ä¼æ¥­ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“',
                    type: 'error',
                    message: `ã€Œ${companyName}ã€ã«è©²å½“ã™ã‚‹ä¼æ¥­ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚`
                };
            }

            // Find similar companies in the same segment
            const similar = companies
                .filter(c => c.segment === company.segment && c.id !== company.id)
                .sort((a, b) => b.score - a.score)
                .slice(0, 3);

            return {
                title: `${company.name} è©³ç´°åˆ†æ`,
                type: 'company_detail',
                data: company,
                similar: similar
            };
        }

        function generateSegmentAnalysisResponse(segments) {
            const targetSegments = segments.length > 0 ? segments : Object.keys(segmentFeatureRates);
            const analysis = targetSegments.map(seg => ({
                name: seg,
                ...segmentFeatureRates[seg],
                companies: companies.filter(c => c.segment === seg)
            }));

            return {
                title: 'ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ¥å¸‚å ´åˆ†æ',
                type: 'segment_analysis',
                data: analysis
            };
        }

        function generateFeatureAnalysisResponse(features) {
            const targetFeatures = features.length > 0 ? features : Object.keys(featureNames).map(k => k.toLowerCase());

            return {
                title: '7æ©Ÿèƒ½è¦ä»¶ å°å…¥çŠ¶æ³åˆ†æ',
                type: 'feature_analysis',
                data: {
                    overall: overallFeatureRates,
                    bySegment: segmentFeatureRates,
                    targetFeatures: targetFeatures
                }
            };
        }

        function generateSalesStrategyResponse(entities) {
            const count = entities.count || 10;
            const topCompanies = companies.slice(0, count);

            return {
                title: `ä»Šé€±ã®å„ªå…ˆã‚¢ãƒ—ãƒ­ãƒ¼ãƒ TOP${count}`,
                type: 'sales_strategy',
                data: topCompanies,
                checklist: [
                    'å„ä¼æ¥­ã®æ‹…å½“éƒ¨é–€ãƒ»ã‚­ãƒ¼ãƒãƒ³ã‚’ç‰¹å®š',
                    'æ—¢å­˜AIã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³å°å…¥çŠ¶æ³ã‚’ç¢ºèª',
                    'åˆå›ãƒ¡ãƒ¼ãƒ«/ã‚³ãƒ¼ãƒ«é€ä¿¡ã‚’å®Œäº†',
                    'ææ¡ˆæ›¸ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º'
                ]
            };
        }

        function generateMarketingInsightResponse(entities) {
            const opportunities = [];

            // Feature opportunities
            for (const [code, name] of Object.entries(featureNames)) {
                const rate = overallFeatureRates[code];
                if (rate < 50) {
                    opportunities.push({
                        feature: name,
                        rate: rate,
                        opportunity: 100 - rate,
                        recommendation: `${100 - rate}%ã®ä¼æ¥­ãŒæœªå°å…¥ã€‚è¨´æ±‚ãƒã‚¤ãƒ³ãƒˆ: ${getFeatureProposalPoint(code)}`
                    });
                }
            }

            opportunities.sort((a, b) => b.opportunity - a.opportunity);

            return {
                title: 'å¸‚å ´æ©Ÿä¼šåˆ†æ',
                type: 'marketing_insight',
                data: {
                    opportunities: opportunities,
                    segments: segmentFeatureRates
                }
            };
        }

        function getFeatureProposalPoint(code) {
            const points = {
                F: 'ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒƒãƒ—ã§é¡§å®¢ä½“é¨“å‘ä¸Š',
                E: 'CMSé€£æºã§é‹ç”¨ã‚³ã‚¹ãƒˆå‰Šæ¸›',
                L: 'AIãƒãƒ£ãƒƒãƒˆã§24æ™‚é–“å¯¾å¿œãƒ»äººä»¶è²»å‰Šæ¸›',
                T: 'ç„¡äººå—ä»˜ã§æ¡ˆå†…æ¥­å‹™åŠ¹ç‡åŒ–',
                H: 'AIâ†’æœ‰äººã‚¹ãƒ ãƒ¼ã‚ºåˆ‡æ›¿ã§é¡§å®¢æº€è¶³åº¦å‘ä¸Š',
                P: 'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æº€ç©ºæƒ…å ±ã§å›éŠæ€§å‘ä¸Š',
                A: 'ãƒ†ãƒŠãƒ³ãƒˆæƒ…å ±ä¸€å…ƒç®¡ç†ã§æ›´æ–°ã‚³ã‚¹ãƒˆå‰Šæ¸›'
            };
            return points[code] || '';
        }

        // ============================================
        // è¡¨ç¤ºé–¢æ•°
        // ============================================

        function displayResponse(response) {
            const container = document.getElementById('resultsContent');
            document.getElementById('resultsTitle').textContent = response.title;

            let html = '';

            switch (response.type) {
                case 'company_list':
                    html = renderCompanyList(response.data, response.summary);
                    break;
                case 'company_detail':
                    html = renderCompanyDetail(response.data, response.similar);
                    break;
                case 'segment_analysis':
                    html = renderSegmentAnalysis(response.data);
                    break;
                case 'feature_analysis':
                    html = renderFeatureAnalysis(response.data);
                    break;
                case 'sales_strategy':
                    html = renderSalesStrategy(response.data, response.checklist);
                    break;
                case 'marketing_insight':
                    html = renderMarketingInsight(response.data);
                    break;
                case 'error':
                    html = `<div class="welcome-screen"><div class="welcome-icon">ğŸ˜•</div><h2 class="welcome-title">${response.message}</h2></div>`;
                    break;
            }

            container.innerHTML = html;
        }

        function renderCompanyList(companies, summary) {
            const statsHtml = `
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-value">${companies.length}</div><div class="stat-label">è©²å½“ä¼æ¥­æ•°</div></div>
                    <div class="stat-card"><div class="stat-value">${companies.filter(c => c.tier === 1).length}</div><div class="stat-label">Tier 1</div></div>
                    <div class="stat-card"><div class="stat-value">${Math.round(companies.reduce((a, c) => a + c.score, 0) / companies.length)}</div><div class="stat-label">å¹³å‡ã‚¹ã‚³ã‚¢</div></div>
                </div>
            `;

            const companiesHtml = companies.map((c, i) => `
                <div class="company-card ${i < 3 ? 'highlight' : ''}">
                    <div class="company-header">
                        <div>
                            <span style="color: var(--warning); margin-right: 8px;">${getRankEmoji(i + 1)}</span>
                            <span class="company-name">${c.url ? `<a href="${c.url}" target="_blank">${c.name}</a>` : c.name}</span>
                        </div>
                        <span class="company-score ${c.score >= 80 ? '' : c.score >= 60 ? 'mid' : 'low'}">${c.score}</span>
                    </div>
                    <div class="company-meta">
                        <span class="meta-badge">${c.segment}</span>
                        <span class="meta-badge tier-${c.tier}">Tier ${c.tier}</span>
                        <span class="meta-badge">${c.region}</span>
                    </div>
                    <div class="feature-dots">
                        ${renderFeatureDots(c.features)}
                    </div>
                    <div class="company-recommendation">
                        <div class="recommendation-label">æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</div>
                        <div class="recommendation-text">${generateRecommendation(c)}</div>
                    </div>
                </div>
            `).join('');

            return statsHtml + '<div class="response-section">' + companiesHtml + '</div>';
        }

        function renderCompanyDetail(company, similar) {
            const featureList = Object.entries(company.features).map(([key, value]) => {
                const code = key === 'floorMap' ? 'F' : key === 'event' ? 'E' : key === 'line' ? 'L' :
                            key === 'touchscreen' ? 'T' : key === 'escalation' ? 'H' : key === 'parking' ? 'P' : 'A';
                const name = featureNames[code];
                const status = value === 2 ? 'â—‹ å®Œå…¨å®Ÿè£…' : value === 1 ? 'â–³ éƒ¨åˆ†å®Ÿè£…' : 'Ã— æœªå®Ÿè£…';
                const opportunity = value === 0 ? ' â† ææ¡ˆæ©Ÿä¼š' : '';
                return `<div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--gray-700);">
                    <span>${code}: ${name}</span>
                    <span style="color: ${value === 2 ? 'var(--success)' : value === 1 ? 'var(--warning)' : 'var(--danger)'};">${status}${opportunity}</span>
                </div>`;
            }).join('');

            const similarHtml = similar.map(s => `
                <tr>
                    <td>${s.name}</td>
                    <td>${s.score}</td>
                    <td>${s.features.escalation === 0 ? 'Ã—' : 'â—‹'}</td>
                </tr>
            `).join('');

            return `
                <div class="segment-card">
                    <div class="segment-header">
                        <div class="segment-name">${company.url ? `<a href="${company.url}" target="_blank" style="color: inherit;">${company.name}</a>` : company.name}</div>
                        <span class="company-score ${company.score >= 80 ? '' : company.score >= 60 ? 'mid' : 'low'}">${company.score}</span>
                    </div>
                    <div class="company-meta" style="margin-bottom: 20px;">
                        <span class="meta-badge">${company.segment}</span>
                        <span class="meta-badge tier-${company.tier}">Tier ${company.tier}</span>
                        <span class="meta-badge">${company.region}</span>
                        <span class="meta-badge">é †ä½: ${company.rank}ä½/299ç¤¾</span>
                    </div>

                    <div style="background: var(--gray-900); border-radius: 10px; padding: 15px; margin-bottom: 20px;">
                        <h4 style="color: var(--primary-light); margin-bottom: 10px;">7æ©Ÿèƒ½è¦ä»¶ å°å…¥çŠ¶æ³</h4>
                        ${featureList}
                    </div>

                    <div style="background: var(--gray-900); border-radius: 10px; padding: 15px; margin-bottom: 20px;">
                        <h4 style="color: var(--secondary); margin-bottom: 10px;">æ¥è§¦æˆ¦ç•¥</h4>
                        <p style="color: var(--gray-400);">
                            <strong>æ¨å¥¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ:</strong> ${getApproachLabel(company.approach)}<br>
                            <strong>ææ¡ˆãƒã‚¤ãƒ³ãƒˆ:</strong> ${generateProposalPoint(company)}
                        </p>
                    </div>
                </div>

                <div class="segment-card">
                    <h4 style="color: var(--gray-300); margin-bottom: 15px;">åŒã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ¯”è¼ƒï¼ˆ${company.segment}ï¼‰</h4>
                    <table class="data-table">
                        <thead><tr><th>ä¼æ¥­å</th><th>ã‚¹ã‚³ã‚¢</th><th>è»¢äººå·¥</th></tr></thead>
                        <tbody>${similarHtml}</tbody>
                    </table>
                </div>
            `;
        }

        function renderSegmentAnalysis(segments) {
            return segments.map(seg => `
                <div class="segment-card">
                    <div class="segment-header">
                        <span class="segment-name">${seg.name}</span>
                        <span class="segment-count">${seg.count}ç¤¾</span>
                    </div>
                    <div class="segment-features">
                        <span class="segment-feature">F: <span class="rate ${seg.F >= 70 ? '' : seg.F >= 40 ? 'mid' : 'low'}">${seg.F}%</span></span>
                        <span class="segment-feature">E: <span class="rate ${seg.E >= 70 ? '' : seg.E >= 40 ? 'mid' : 'low'}">${seg.E}%</span></span>
                        <span class="segment-feature">L: <span class="rate ${seg.L >= 70 ? '' : seg.L >= 40 ? 'mid' : 'low'}">${seg.L}%</span></span>
                        <span class="segment-feature">T: <span class="rate ${seg.T >= 70 ? '' : seg.T >= 40 ? 'mid' : 'low'}">${seg.T}%</span></span>
                        <span class="segment-feature">H: <span class="rate ${seg.H >= 70 ? '' : seg.H >= 40 ? 'mid' : 'low'}">${seg.H}%</span></span>
                        <span class="segment-feature">P: <span class="rate ${seg.P >= 70 ? '' : seg.P >= 40 ? 'mid' : 'low'}">${seg.P}%</span></span>
                        <span class="segment-feature">A: <span class="rate ${seg.A >= 70 ? '' : seg.A >= 40 ? 'mid' : 'low'}">${seg.A}%</span></span>
                    </div>
                    <div class="segment-insight">
                        <span class="insight-highlight">å¸‚å ´æ©Ÿä¼š:</span> ${getSegmentOpportunity(seg)}
                    </div>
                </div>
            `).join('');
        }

        function renderFeatureAnalysis(data) {
            const overallHtml = Object.entries(data.overall).map(([code, rate]) => `
                <div class="stat-card">
                    <div class="stat-value" style="color: ${rate >= 70 ? 'var(--success)' : rate >= 40 ? 'var(--warning)' : 'var(--danger)'};">${rate}%</div>
                    <div class="stat-label">${code}: ${featureNames[code]}</div>
                </div>
            `).join('');

            return `
                <div class="response-section">
                    <div class="response-section-title">æ¥­ç•Œå…¨ä½“ å°å…¥ç‡</div>
                    <div class="stats-grid">${overallHtml}</div>
                </div>
                <div class="response-section">
                    <div class="response-section-title">æˆ¦ç•¥çš„ã‚¤ãƒ³ã‚µã‚¤ãƒˆ</div>
                    <div class="segment-card">
                        <p style="color: var(--gray-400); margin-bottom: 10px;">
                            <span class="insight-highlight">è»¢äººå·¥å¯¾å¿œ (5%)</span> - 95%ãŒæœªé–‹æ‹“ã€‚GBaseæœ€å¤§ã®å·®åˆ¥åŒ–æ©Ÿä¼šã€‚é‹è¼¸æ¥­ã®ã¿å°å…¥ã€‚
                        </p>
                        <p style="color: var(--gray-400); margin-bottom: 10px;">
                            <span class="insight-highlight">ãƒ†ãƒŠãƒ³ãƒˆæƒ…å ±API (12%)</span> - æ¥­ç•Œå…¨ä½“ã§æœªæ•´å‚™ã€‚æ¨™æº–åŒ–ææ¡ˆã®å¥½æ©Ÿã€‚
                        </p>
                        <p style="color: var(--gray-400);">
                            <span class="insight-highlight">LINE Bot (38%)</span> - 62%ãŒæœªå°å…¥ã€‚AIãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã§ã®å·®åˆ¥åŒ–å¯èƒ½ã€‚
                        </p>
                    </div>
                </div>
            `;
        }

        function renderSalesStrategy(companies, checklist) {
            const companiesHtml = renderCompanyList(companies, '');
            const checklistHtml = `
                <div class="action-checklist">
                    <div class="checklist-title">è¡Œå‹•ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ</div>
                    ${checklist.map(item => `
                        <div class="checklist-item">
                            <div class="checkbox" onclick="this.style.background = this.style.background ? '' : 'var(--success)'"></div>
                            <span>${item}</span>
                        </div>
                    `).join('')}
                </div>
            `;
            return companiesHtml + checklistHtml;
        }

        function renderMarketingInsight(data) {
            const opportunitiesHtml = data.opportunities.map(opp => `
                <div class="company-card">
                    <div class="company-header">
                        <span class="company-name">${opp.feature}</span>
                        <span class="company-score low">${opp.rate}% å°å…¥</span>
                    </div>
                    <p style="color: var(--success); font-weight: 600; margin-bottom: 8px;">${opp.opportunity}% ã®å¸‚å ´æ©Ÿä¼š</p>
                    <p style="color: var(--gray-400); font-size: 0.9rem;">${opp.recommendation}</p>
                </div>
            `).join('');

            return `
                <div class="response-section">
                    <div class="response-section-title">æœªé–‹æ‹“å¸‚å ´æ©Ÿä¼šï¼ˆé™é †ï¼‰</div>
                    ${opportunitiesHtml}
                </div>
            `;
        }

        // ============================================
        // ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
        // ============================================

        function renderFeatureDots(features) {
            const codes = { floorMap: 'F', event: 'E', line: 'L', touchscreen: 'T', escalation: 'H', parking: 'P', api: 'A' };
            return Object.entries(features).map(([key, value]) => {
                const className = value === 2 ? 'match' : value === 1 ? 'partial' : 'no-match';
                return `<span class="feature-dot ${className}" title="${featureNames[codes[key]]}">${codes[key]}</span>`;
            }).join('');
        }

        function getRankEmoji(rank) {
            if (rank === 1) return 'ğŸ¥‡';
            if (rank === 2) return 'ğŸ¥ˆ';
            if (rank === 3) return 'ğŸ¥‰';
            return `#${rank}`;
        }

        function getApproachLabel(approach) {
            const labels = { direct: 'ç›´æ¥å–¶æ¥­', partner: 'ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼çµŒç”±', event: 'å±•ç¤ºä¼šãƒ»ã‚»ãƒŸãƒŠãƒ¼', referral: 'ç´¹ä»‹' };
            return labels[approach] || approach;
        }

        function generateRecommendation(company) {
            const unimplemented = [];
            if (company.features.escalation === 0) unimplemented.push('è»¢äººå·¥å¯¾å¿œ');
            if (company.features.api === 0) unimplemented.push('ãƒ†ãƒŠãƒ³ãƒˆAPI');
            if (company.features.line === 0) unimplemented.push('LINE Bot');

            if (unimplemented.length > 0) {
                return `${unimplemented.slice(0, 2).join('ãƒ»')} ã®ææ¡ˆæ©Ÿä¼šã‚ã‚Šã€‚${getApproachLabel(company.approach)}ã§ã‚¢ãƒ—ãƒ­ãƒ¼ãƒæ¨å¥¨ã€‚`;
            }
            return `é«˜ã„æ©Ÿèƒ½å®Ÿè£…ç‡ã€‚ã‚¢ãƒƒãƒ—ã‚»ãƒ«ãƒ»æ‹¡å¼µææ¡ˆã‚’æ¤œè¨ã€‚`;
        }

        function generateProposalPoint(company) {
            if (company.features.escalation === 0) {
                return 'è»¢äººå·¥å¯¾å¿œï¼ˆAIâ†’æœ‰äººåˆ‡æ›¿ï¼‰ã§é¡§å®¢æº€è¶³åº¦å‘ä¸Šã€‚95%ã®ä¼æ¥­ãŒæœªå°å…¥ã®å·®åˆ¥åŒ–æ©Ÿèƒ½ã€‚';
            }
            if (company.features.api === 0) {
                return 'ãƒ†ãƒŠãƒ³ãƒˆæƒ…å ±APIã§æ›´æ–°æ¥­å‹™åŠ¹ç‡åŒ–ã€‚æ¥­ç•Œæ¨™æº–åŒ–ã®å…ˆè¡Œå°å…¥ãƒ¡ãƒªãƒƒãƒˆã‚’è¨´æ±‚ã€‚';
            }
            return 'ãƒ•ãƒ«ã‚¹ã‚¤ãƒ¼ãƒˆå°å…¥ã«ã‚ˆã‚‹ç·åˆçš„ãªDXæ¨é€²ã‚’ææ¡ˆã€‚';
        }

        function getSegmentOpportunity(seg) {
            const opportunities = [];
            if (seg.H < 10) opportunities.push('è»¢äººå·¥å¯¾å¿œ');
            if (seg.A < 20) opportunities.push('ãƒ†ãƒŠãƒ³ãƒˆAPI');
            if (seg.L < 40) opportunities.push('LINE Bot');
            return opportunities.length > 0
                ? `${opportunities.join('ãƒ»')} ã®å°å…¥ä½™åœ°ãŒå¤§ãã„`
                : 'é«˜ã„å®Ÿè£…ç‡ã€‚ã‚¢ãƒƒãƒ—ã‚»ãƒ«æˆ¦ç•¥ãŒæœ‰åŠ¹';
        }

        // ============================================
        // UIæ“ä½œé–¢æ•°
        // ============================================

        function setQuery(query) {
            document.getElementById('searchInput').value = query;
            processQuery();
        }

        function executeAction(action) {
            const actionQueries = {
                'top10': 'ä»Šé€±ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã™ã¹ãä¼æ¥­TOP10',
                'escalation': 'è»¢äººå·¥å¯¾å¿œã«èˆˆå‘³ãŒã‚ã‚Šãã†ãªä¼æ¥­',
                'highscore': 'é«˜ã‚¹ã‚³ã‚¢ä¼æ¥­TOP20',
                'segment_recommend': 'å„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®å¸‚å ´æ©Ÿä¼š',
                'market_opportunity': 'å„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®å¸‚å ´æ©Ÿä¼š',
                'feature_analysis': '7æ©Ÿèƒ½è¦ä»¶ã®å°å…¥çŠ¶æ³',
                'proposal_points': 'æ©Ÿèƒ½åˆ¥è¨´æ±‚ãƒã‚¤ãƒ³ãƒˆ',
                'segment_list': 'ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ¥ä¼æ¥­ä¸€è¦§',
                'region_analysis': 'åœ°åŸŸåˆ¥ä¼æ¥­åˆ†å¸ƒ'
            };
            setQuery(actionQueries[action] || action);
        }

        function showCompanySearch() {
            const name = prompt('ä¼æ¥­åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:');
            if (name) {
                setQuery(`${name}ã®è©³ç´°æƒ…å ±`);
            }
        }

        function showLoading() {
            document.getElementById('resultsContent').innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <div class="loading-text">åˆ†æä¸­...</div>
                </div>
            `;
        }

        function clearResults() {
            document.getElementById('resultsTitle').textContent = 'AIãƒŠãƒ“ã‚²ãƒ¼ã‚¿ãƒ¼';
            document.getElementById('resultsContent').innerHTML = `
                <div class="welcome-screen" id="welcomeScreen">
                    <div class="welcome-icon">ğŸ¯</div>
                    <h2 class="welcome-title">SCæ¥­ç•Œ299ç¤¾ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ¤œç´¢</h2>
                    <p class="welcome-subtitle">
                        ä¸Šã®æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ã«è³ªå•ã‚’å…¥åŠ›ã™ã‚‹ã‹ã€å·¦ã®ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦é–‹å§‹ã—ã¦ãã ã•ã„ã€‚
                    </p>
                </div>
            `;
        }

        // History management
        let searchHistory = [];

        function addToHistory(query) {
            searchHistory.unshift({ query, time: new Date() });
            if (searchHistory.length > 10) searchHistory.pop();
            updateHistoryDisplay();
        }

        function updateHistoryDisplay() {
            const section = document.getElementById('historySection');
            const list = document.getElementById('historyList');

            if (searchHistory.length === 0) {
                section.style.display = 'none';
                return;
            }

            section.style.display = 'block';
            list.innerHTML = searchHistory.map(h => `
                <div class="history-item" onclick="setQuery('${h.query}')">
                    <span class="history-query">${h.query}</span>
                    <span class="history-time">${formatTime(h.time)}</span>
                </div>
            `).join('');
        }

        function formatTime(date) {
            const diff = Math.floor((new Date() - date) / 1000);
            if (diff < 60) return 'ä»Š';
            if (diff < 3600) return `${Math.floor(diff / 60)}åˆ†å‰`;
            return `${Math.floor(diff / 3600)}æ™‚é–“å‰`;
        }

        function exportResults() {
            const title = document.getElementById('resultsTitle').textContent;
            alert(`ã€Œ${title}ã€ã®CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã¯é–‹ç™ºä¸­ã§ã™ã€‚`);
        }

        // Enter key handler
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                processQuery();
            }
        });
    </script>
</body>
</html>
